var QuestionInterface = function () {
	function t(e, i, n, s, o, a, l, h) {
		var c = !1,
		r = c ? "assets/images/" : "https://prodigy.blob.core.windows.net/" + t.VERSION + "/images/";
		this.IMAGE_PATH = r,
		this.skillJson = i,
		this.questionID = n,
		this.disableHelp = !l && !s,
		this.additionalChances = s && "mc" !== this.skillJson.skill.template.type && !this.disableHelp ? 1 : 0,
		this.completeCallback = o,
		this.inAmerica = a,
		this.isTutorial = l,
		this.hideCallback = h,
		this.container = document.getElementById(e),
		$(this.container).empty().width("100%").height("100%"),
		this.interfaceContainer = document.createElement("div"),
		this.interfaceContainer.classList.add("question-interface"),
		this.container.appendChild(this.interfaceContainer),
		this.resize(),
		this["interface"] = document.createElement("div"),
		this["interface"].style.display = "none",
		this.interfaceContainer.appendChild(this["interface"]),
		this.images = {
			bg: r + "core/bg-tile-grey-light.png",
			back: r + "core/back.png",
			close: r + "core/close.png",
			loading: r + "core/loading.png",
			next: r + "core/next.png",
			exit: r + "ui/back.png",
			colon: r + "ui/colon.png",
			cbrt: r + "ui/cube-root.png",
			decimal: r + "ui/decimal.png",
			del: r + "ui/delete.png",
			eight: r + "ui/eight.png",
			equals: r + "ui/equals.png",
			erase: r + "ui/erase.png",
			five: r + "ui/five.png",
			fslash: r + "ui/forward-slash.png",
			four: r + "ui/four.png",
			go: r + "ui/go.png",
			gt: r + "ui/greater-than.png",
			lt: r + "ui/less-than.png",
			minus: r + "ui/minus.png",
			nine: r + "ui/nine.png",
			one: r + "ui/one.png",
			hint: r + "ui/open-hint.png",
			lesson: r + "ui/open-lesson.png",
			percent: r + "ui/percent.png",
			plus: r + "ui/plus.png",
			seven: r + "ui/seven.png",
			six: r + "ui/six.png",
			sqrt: r + "ui/square-root.png",
			three: r + "ui/three.png",
			tools: r + "ui/tools.png",
			tts: r + "ui/tts.png",
			two: r + "ui/two.png",
			zero: r + "ui/zero.png"
		},
		this.loadingMenu = new t.LoadingMenu(this.interfaceContainer, this.images),
		this.setup(i, n, s, o);
		var u = [];
		for (var d in this.images)
			u.push(this.images[d]);
		this.loadImages(u)
	}
	return t.prototype = Object.create(Object.prototype),
	t.VERSION = "edu-question-interface-1-4-2",
	t.prototype.setup = function () {
		this.toolsButton = new t.Button(this["interface"], this.images.tools, {
				top: 300,
				right: 15
			}, this.openManipulatives.bind(this)),
		this.questionMenu = new t.QuestionMenu(this["interface"], this.images, this.skillJson, this.questionID, this.skillJson.skill.hintTemplate && !this.disableHelp ? this.openHint.bind(this) : null, this.skillJson.skill.lessonID && !this.disableHelp ? this.openLesson.bind(this) : null, this.submitQuestion.bind(this)),
		this.focusButton = this.questionMenu.inputElements.goButton,
		$(document).on("keydown", function (e) {
			if ("input-override" !== document.activeElement.className) {
				13 === e.keyCode && (e.preventDefault(), e.stopPropagation(), this.focusButton && this.focusButton.trigger());
				var i = t.getSelectedTextbox();
				i && !i.readOnly ? (t.selectTextbox(i), i.focus(), i.value = i.value + "") : (e.preventDefault(), e.stopPropagation())
			}
		}
			.bind(this)),
		$(document).on("touchstart touchmove touchend", function (t) {
			t.preventDefault()
		}),
		$(window).on("resize", this.resize.bind(this))
	},
	t.prototype.loadImages = function (t) {
		if (this.loadedImages = [], 0 === t.length)
			this.displayInterface();
		else {
			var e = new Image,
			i = t.pop();
			$(e).on("load error", function () {
				$(e).off(),
				this.loadedImages.push(e),
				this.loadImages(t)
			}
				.bind(this)),
			e.src = i
		}
	},
	t.prototype.displayInterface = function () {
		this.loadingMenu.fadeInBackground(),
		$(this["interface"]).delay(500).fadeIn(300, function () {
			this.startTime = new Date,
			this.hideCallback && this.hideCallback()
		}
			.bind(this)),
		this.isTutorial && this.startTutorial()
	},
	t.prototype.startTutorial = function () {
		this.dialogueMenu = new t.DialogueMenu(this["interface"], this.IMAGE_PATH, ['To cast a spell, you must answer the question correctly. After entering your answer, press the big <span style="color:' + Controller.COLORS.lightgreen + '">GO button</span> to submit it!', 'Our <span style="color:' + Controller.COLORS.lightblue + '">help buttons</span> can read the question out loud, or provide hints, lessons, and manipulatives!', "Now, let's answer this question and cast your first spell!"])
	},
	t.prototype.resize = function () {
		var t = $(this.container).width() || window.innerWidth,
		e = $(this.container).height() || window.innerHeight,
		i = "scale(" + t / 1280 + "," + e / 720 + ")";
		$(this.interfaceContainer).css({
			"-webkit-transform": i,
			"-moz-transform": i,
			"-ms-transform": i,
			transform: i
		})
	},
	t.prototype.openHint = function () {
		this.questionMenu.hide(),
		this.hintMenu || (t.trackEvent("HintOpen", this.skillJson.skill.ID), this.hintMenu = new t.HintMenu(this["interface"], this.images, this.skillJson, this.questionID, this.closeHint.bind(this))),
		this.hintMenu.show(),
		this.focusButton = this.hintMenu.hintButton
	},
	t.prototype.openLesson = function () {
		this.questionMenu.hide(),
		this.lessonMenu || (t.trackEvent("LessonOpen", this.skillJson.skill.ID), this.lessonMenu = new t.LessonMenu(this["interface"], this.images, this.IMAGE_PATH, this.skillJson.skill.lessonID, this.closeLesson.bind(this))),
		this.lessonMenu.show(),
		this.focusButton = this.lessonMenu.lessonButton
	},
	t.prototype.closeLesson = function () {
		this.focusButton = this.questionMenu.inputElements.goButton,
		this.questionMenu.show(),
		this.lessonMenu.close(),
		this.lessonMenu = null
	},
	t.prototype.openManipulatives = function () {
		this.manipulativeMenu || (this.manipulativeMenu = new t.ManipulativeMenu(this["interface"], this.skillJson.skill.ID, this.inAmerica, this.images, this.IMAGE_PATH, this.closeManipulatives.bind(this))),
		this.manipulativeMenu.closeButton.show(),
		this.manipulativeMenu.show(),
		this.toolsButton.hide()
	},
	t.prototype.closeManipulatives = function () {
		this.manipulativeMenu.closeButton.hide(),
		this.manipulativeMenu.hide(),
		this.toolsButton.show()
	},
	t.prototype.closeHint = function () {
		this.focusButton = this.questionMenu.inputElements.goButton,
		this.questionMenu.show(),
		this.hintMenu.close(),
		this.hintMenu = null
	},
	t.prototype.submitQuestion = function () {
		if (!this.questionMenu.isValid()) {
			var e = "Make sure you answer the question before you submit it! ";
			switch (this.skillJson.skill.template.type) {
			case "mc":
				e += "Click the options below to select your answer.";
				break;
			case "tb":
				e += "Click on each white box and use the keyboard to enter your answer.";
				break;
			case "dd":
				e += "Click on each white box to see the available choices and select your answer."
			}
			return void(this.dialogueMenu ? this.dialogueMenu.startNewDialogue([e]) : this.dialogueMenu = new t.DialogueMenu(this["interface"], this.IMAGE_PATH, [e]))
		}
		if (this.questionMenu.inputElements.hide(), this.questionMenu.deactivateButtons(), this.submittedInput = this.questionMenu.getInput(), this.isCorrect = this.questionMenu.isCorrect(), this.endTime = new Date, this.isCorrect) {
			t.trackEvent("CorrectAnswer", this.skillJson.skill.ID),
			this.questionMenu.displayCorrect();
			var i = new t.Notice(this["interface"]);
			i.fadeInText("This is the correct answer to the problem!");
			var n = new t.Button(this["interface"], this.images.close, {
					bottom: 50,
					left: 513
				}, function () {
					n.close(),
					i.close(),
					this.close()
				}
					.bind(this));
			this.focusButton = n
		} else if (this.additionalChances > 0) {
			this.additionalChances--,
			this.questionMenu.controller.disableInput();
			var i = new t.Notice(this["interface"]);
			i.fadeInText("That answer is incorrect... Let's see a hint and try again!");
			var s = new t.Button(this["interface"], this.images.next, {
					bottom: 50,
					left: 500
				}, function () {
					s.close(),
					i.close(),
					this.openHint(),
					this.questionMenu.reactivateButtons(),
					this.questionMenu.controller.enableInput()
				}
					.bind(this));
			this.focusButton = s
		} else {
			t.trackEvent("IncorrectAnswer", this.skillJson.skill.ID),
			this.questionMenu.setInput(this.submittedInput),
			this.questionMenu.displayIncorrect();
			var i = new t.Notice(this["interface"]);
			i.fadeInText("This answer is incorrect. Let's see the correct answer!");
			var s,
			o,
			n;
			s = new t.Button(this["interface"], this.images.next, {
					bottom: 50,
					left: 693
				}, function () {
					i.fadeInText("This is the correct answer to the problem."),
					this.focusButton = o,
					o.show(),
					s.hide(),
					this.questionMenu.displayCorrect()
				}
					.bind(this)),
			o = new t.Button(this["interface"], this.images.back, {
					bottom: 50,
					left: 309
				}, function () {
					i.fadeInText("This answer is incorrect. Let's see the correct answer!"),
					this.focusButton = n,
					o.hide(),
					s.show(),
					this.questionMenu.setInput(this.submittedInput),
					this.questionMenu.displayIncorrect()
				}
					.bind(this)),
			n = new t.Button(this["interface"], this.images.close, {
					bottom: 50,
					left: 513
				}, function () {
					s.close(),
					o.close(),
					i.close(),
					n.close(),
					this.close()
				}
					.bind(this)),
			this.focusButton = s,
			o.hide()
		}
	},
	t.prototype.close = function () {
		this.audio && (this.audio.pause(), $(this.audio).off(), this.audio = null),
		this.dialogueMenu && this.dialogueMenu.close(),
		this.completeCallback && this.completeCallback(this.isCorrect, this.submittedInput, (this.endTime - this.startTime) / 1e3),
		this.completeCallback = null,
		this.hideCallback = null,
		this.questionMenu.close(),
		this.questionMenu = null,
		this.toolsButton.close(),
		this.toolsButton = null,
		this.manipulativeMenu && this.manipulativeMenu.close(),
		this.eraseButton && this.eraseButton.close(),
		this.eraseButton = null,
		this.interfaceContainer.className = "",
		this.interfaceContainer.style.backgroundImage = "",
		this.interfaceContainer.removeChild(this["interface"]),
		this.focusButton = null,
		this.skillJson = null,
		$("textarea.control").off(),
		$(window).off(),
		$(document).off(),
		$(this.container).empty(),
		this.interfaceContainer = null,
		this["interface"] = null
	},
	t
}
();
QuestionInterface.getSelectedTextbox = function () {
	return $(".qi-selected-input")[0] || $("textarea.control")[0]
}, QuestionInterface.selectTextbox = function (t) {
	$(".qi-selected-input").removeClass("qi-selected-input"),
	$(t).addClass("qi-selected-input")
}, QuestionInterface.trackEvent = function (t, e) {
	try {
		_gaq.push(["_trackEvent", "Questions", t, e + ""])
	} catch (i) {}
}, console.log("%c %c %c Question Interface v" + QuestionInterface.VERSION.replace("edu-question-interface-", "").replace(/-/g, ".") + " %c %c ", "background: #CCC", "background: #BBB", "background: #AAA; color: #FFF", "background: #BBB", "background: #CCC"), $("<link>", {
	rel: "stylesheet",
	type: "text/css",
	href: "web.archive.org/web/20170202232637im_/https://prodigy.blob.core.windows.net/edu-question-interface-1-4-2/style/QuestionInterfaceStyle.css"
}).appendTo("head"), QuestionInterface.Element = function () {
	return Element.prototype = Object.create(Object.prototype),
	Element.prototype.hide = function () {
		this.element.classList.add("hidden")
	},
	Element.prototype.show = function () {
		this.element.classList.remove("hidden")
	},
	Element.prototype.isHidden = function () {
		return this.element.classList.contains("hidden")
	},
	Element.prototype.deactivate = function () {
		this.element.classList.add("inactive")
	},
	Element.prototype.reactivate = function () {
		this.element.classList.remove("inactive")
	},
	Element.prototype.isInactive = function () {
		return this.element.classList.contains("inactive")
	},
	Element.prototype.close = function () {
		this.container.removeChild(this.element),
		this.container = null,
		$(this.element).off(),
		$(this.element).empty(),
		this.element = null
	},
	Element
}
(), QuestionInterface.Button = function () {
	function t(t, e, i, n) {
		this.container = t,
		this.callback = n,
		this.element = document.createElement("img"),
		this.element.src = e,
		this.element.draggable = !1,
		this.element.classList.add("qi-button"),
		this.element.style.position = "absolute";
		for (var s in i)
			this.element.style[s] = i[s] + "px";
		this.callback ? this.reactivate() : this.deactivate(),
		$(this.element).on("mousedown touchstart", function (t) {
			t.preventDefault(),
			t.stopPropagation(),
			this.isInactive() || this.isHidden() || n()
		}
			.bind(this)),
		this.container.appendChild(this.element)
	}
	return t.prototype = Object.create(QuestionInterface.Element.prototype),
	t.prototype.reactivate = function () {
		this.callback && QuestionInterface.Element.prototype.reactivate.call(this)
	},
	t.prototype.trigger = function () {
		$(this.element).mousedown()
	},
	t
}
(), QuestionInterface.Keyboard = function () {
	function t(t, e) {
		this.container = t,
		this.element = document.createElement("div"),
		this.element.style.position = "absolute",
		this.element.style.width = "935px",
		this.element.style.height = "175px",
		this.element.style.bottom = "15px",
		this.element.style.left = "15px",
		this.container.appendChild(this.element);
		var i = [{
				src: e.one,
				val: "1"
			}, {
				src: e.two,
				val: "2"
			}, {
				src: e.three,
				val: "3"
			}, {
				src: e.four,
				val: "4"
			}, {
				src: e.five,
				val: "5"
			}, {
				src: e.six,
				val: "6"
			}, {
				src: e.seven,
				val: "7"
			}, {
				src: e.eight,
				val: "8"
			}, {
				src: e.nine,
				val: "9"
			}, {
				src: e.zero,
				val: "0"
			}, {
				src: e.del,
				val: "DELETE"
			}, {
				src: e.plus,
				val: "+"
			}, {
				src: e.minus,
				val: "-"
			}, {
				src: e.percent,
				val: "%"
			}, {
				src: e.equals,
				val: "="
			}, {
				src: e.lt,
				val: "<"
			}, {
				src: e.gt,
				val: ">"
			}, {
				src: e.colon,
				val: ":"
			}, {
				src: e.fslash,
				val: "/"
			}, {
				src: e.decimal,
				val: "."
			}, {
				src: e.sqrt,
				val: "√"
			}, {
				src: e.cbrt,
				val: "∛"
			}
		],
		n = 95;
		this.keys = [];
		for (var s = 0; s < i.length; s++)
			(function (t) {
				this.keys.push(new QuestionInterface.Button(this.element, i[s].src, {
						top: n * Math.floor(s / 11),
						left: n * (s % 11)
					}, function () {
						textBox = QuestionInterface.getSelectedTextbox(),
						textBox && ("DELETE" === t ? textBox.value = textBox.value.slice(0, -1) : textBox.value += t)
					}
						.bind(this)))
			}).bind(this)(i[s].val)
	}
	return t.prototype = Object.create(QuestionInterface.Element.prototype),
	t.prototype.close = function () {
		for (var t = 0; t < this.keys.length; t++)
			this.keys[t].close();
		this.container.removeChild(this.element)
	},
	t
}
(), QuestionInterface.InputElements = function () {
	function t(t, e, i, n) {
		this.container = t,
		this.element = document.createElement("div"),
		this.container.appendChild(this.element),
		this.goButton = new QuestionInterface.Button(this.element, e.go, {
				bottom: 15,
				right: 15
			}, i),
		this.keyboard = new QuestionInterface.Keyboard(this.element, e, n)
	}
	return t.prototype = Object.create(Element.prototype),
	t.prototype.hideKeyboard = function () {
		this.keyboard.hide()
	},
	t.prototype.bindTextBox = function () {
		this.keyboard.bindTextBox()
	},
	t.prototype.unbindTextBox = function () {
		this.keyboard.unbindTextBox()
	},
	t.prototype.close = function () {
		this.goButton.close(),
		this.keyboard.close(),
		QuestionInterface.Element.prototype.close.call(this)
	},
	t
}
(), QuestionInterface.Loader = function () {
	function t(t, e) {
		this.container = t,
		this.element = document.createElement("img"),
		this.element.src = e.loading,
		this.element.classList.add("qi-loader"),
		this.container.appendChild(this.element)
	}
	return t.prototype = Object.create(Element.prototype),
	t
}
(), QuestionInterface.Notice = function () {
	function t(e) {
		this.element = document.createElement("div"),
		$(this.element).css({
			"text-shadow": "-1px -1px 0 black, 1px -1px 0 black, -1px 1px 0 black, 1px 1px 0 black",
			color: "white",
			"font-family": "Roboto",
			"font-size": "30px",
			"font-weight": "bolder",
			position: "absolute",
			width: "1184px",
			bottom: "150px",
			"text-align": "center",
			"-webkit-touch-callout": "none",
			"-webkit-user-select": "none",
			"-khtml-user-select": "none",
			"-moz-user-select": "none",
			"-ms-user-select": "none"
		}),
		this.container = e,
		this.container.appendChild(this.element),
		t.prototype.fadeInText = function (t) {
			this.element.innerHTML = t
		}
	}
	return t.prototype = Object.create(Element.prototype),
	t
}
(), QuestionInterface.MenuScreen = function () {
	function t(t, e, i) {
		this.container = t,
		this.element = document.createElement("div"),
		this.container.appendChild(this.element),
		this.loader = new QuestionInterface.Loader(this.container, e),
		this.images = e,
		this.skillID = i
	}
	return t.prototype = Object.create(QuestionInterface.Element.prototype),
	t.prototype.addMenuButtons = function () {
		this.ttsButton = this.ttsButton || new QuestionInterface.Button(this.container, this.images.tts, {
				top: 15,
				right: 15
			}, this.audioSrc ? this.playTextToSpeech.bind(this) : null),
		this.hintButton = this.hintButton || new QuestionInterface.Button(this.container, this.images.hint, {
				top: 110,
				right: 15
			}),
		this.lessonButton = this.lessonButton || new QuestionInterface.Button(this.container, this.images.lesson, {
				top: 205,
				right: 15
			})
	},
	t.prototype.playTextToSpeech = function () {
		this.ttsButton.deactivate(),
		this.audio ? (this.audio.currentTime = 0, this.audio.paused && this.audio.play()) : (this.audio = document.createElement("audio"), $(this.audio).on("canplaythrough", function () {
				this.audio.play()
			}
				.bind(this)), $(this.audio).on("ended", function () {
				this.ttsButton.reactivate()
			}
				.bind(this)), this.audio.src = this.audioSrc, this.audio.load(), QuestionInterface.trackEvent("TTS", this.skillID))
	},
	t.prototype.hide = function () {
		this.loader && this.loader.hide(),
		this.audio && this.audio.pause(),
		this.ttsButton.hide(),
		this.hintButton.hide(),
		this.lessonButton.hide(),
		QuestionInterface.Element.prototype.hide.call(this)
	},
	t.prototype.show = function () {
		this.loader && this.loader.show(),
		this.ttsButton.show(),
		this.hintButton.show(),
		this.lessonButton.show(),
		QuestionInterface.Element.prototype.show.call(this)
	},
	t.prototype.close = function () {
		this.loader && (this.loader.close(), this.loader = null),
		this.audio && (this.audio.pause(), $(this.audio).off(), this.audio = null),
		this.ttsButton.close(),
		this.hintButton.close(),
		this.lessonButton.close(),
		this.ttsButton = null,
		this.hintButton = null,
		this.lessonButton = null,
		QuestionInterface.Element.prototype.close.call(this)
	},
	t
}
(), QuestionInterface.HintMenu = function () {
	function t(t, e, i, n, s) {
		QuestionInterface.MenuScreen.call(this, t, e, i.skill.ID),
		this.controller = new Controller,
		this.controller.create(i, n, !0, function () {
			this.loader.close(),
			this.loader = null,
			$(this.element).css({
				position: "absolute",
				top: (530 - this.controller.getHeight()) / 2 + "px",
				left: (1185 - this.controller.getWidth()) / 2 + "px"
			}),
			this.element.appendChild(this.controller.getEl())
		}
			.bind(this)),
		this.hintButton = new QuestionInterface.Button(this.container, e.exit, {
				top: 110,
				right: 15
			}, s),
		this.backButton = new QuestionInterface.Button(this.container, e.back, {
				bottom: 50,
				left: 500
			}, s);
		for (var o = i.skill.questions, a = 0; a < o.length; a++)
			if (o[a].ID === n)
				return this.audioSrc = "https://prodigy.blob.core.windows.net/edu-tts-1-4-2/hint/" + n + ".mp3", void this.addMenuButtons();
		this.addMenuButtons()
	}
	return t.prototype = Object.create(QuestionInterface.MenuScreen.prototype),
	t.prototype.close = function () {
		this.loader && (this.loader.close(), this.loader = null),
		this.audio && (this.audio.pause(), $(this.audio).off(), this.audio = null),
		this.controller.clear(),
		this.controller = null,
		this.backButton.close(),
		this.backButton = null,
		QuestionInterface.MenuScreen.prototype.close.call(this)
	},
	t
}
(), QuestionInterface.LessonMenu = function () {
	function t(t, e, i, n, s) {
		QuestionInterface.MenuScreen.call(this, t, e),
		this.lesson = document.createElement("div"),
		this.element.appendChild(this.lesson),
		this.lessonImage = new Image,
		this.lessonImage.draggable = !1,
		this.lessonImage.style.position = "absolute",
		$(this.lessonImage).on("load error", function () {
			this.loader.close(),
			this.loader = null,
			this.lessonSize = this.lessonImage.width,
			$(this.lesson).css({
				position: "absolute",
				overflow: "hidden",
				top: (530 - this.lessonSize) / 2 + "px",
				left: (1185 - this.lessonSize) / 2 + "px",
				width: this.lessonSize + "px",
				height: this.lessonSize + "px"
			}),
			this.lesson.appendChild(this.lessonImage),
			$(this.lessonImage).off(),
			this.lessonPage = 0,
			this.flipPage()
		}
			.bind(this)),
		this.lessonImage.src = i + "lessons/" + n + ".png",
		this.lessonButton = new QuestionInterface.Button(this.element, e.exit, {
				top: 205,
				right: 15
			}, s),
		this.closeButton = new QuestionInterface.Button(this.element, e.close, {
				bottom: 50,
				left: 513
			}, s),
		this.addMenuButtons()
	}
	return t.prototype = Object.create(QuestionInterface.MenuScreen.prototype),
	t.prototype.flipPage = function () {
		this.nextButton || (this.nextButton = new QuestionInterface.Button(this.element, this.images.next, {
					bottom: 50,
					left: 693
				}, this.displayNext.bind(this))),
		this.backButton || (this.backButton = new QuestionInterface.Button(this.element, this.images.back, {
					bottom: 50,
					left: 309
				}, this.displayPrev.bind(this))),
		this.lessonImage.style.top = -this.lessonSize * this.lessonPage + "px",
		0 === this.lessonPage ? this.backButton.hide() : this.backButton.show();
		var t = this.lessonImage.height / this.lessonSize;
		this.lessonPage < t - 1 ? this.nextButton.show() : this.nextButton.hide()
	},
	t.prototype.displayNext = function () {
		this.lessonPage++,
		this.flipPage()
	},
	t.prototype.displayPrev = function () {
		this.lessonPage--,
		this.flipPage()
	},
	t.prototype.close = function () {
		this.loader && (this.loader.close(), this.loader = null),
		this.closeButton.close(),
		this.closeButton = null,
		this.backButton && (this.backButton.close(), this.backButton = null),
		this.nextButton && (this.nextButton.close(), this.nextButton = null),
		$(this.lessonImage).off(),
		QuestionInterface.MenuScreen.prototype.close.call(this)
	},
	t
}
(), QuestionInterface.QuestionMenu = function () {
	function t(t, e, i, n, s, o, a) {
		QuestionInterface.MenuScreen.call(this, t, e, i.skill.ID),
		$(this.element).css({
			"z-index": 1
		}),
		this.inputElements = new QuestionInterface.InputElements(this.container, this.images, a),
		"tb" !== i.skill.template.type && this.inputElements.hideKeyboard(),
		this.controller = new Controller,
		this.controller.create(i, n, !1, function () {
			this.loader.close(),
			this.loader = null,
			$(this.element).css({
				position: "absolute",
				top: (530 - this.controller.getHeight()) / 2 + "px",
				left: (1185 - this.controller.getWidth()) / 2 + "px",
				"z-index": 4
			}),
			this.element.appendChild(this.controller.getEl()),
			$("textarea.control").on("touchstart", function (t) {
				t.target.blur()
			}),
			$("textarea.control").on("touchstart focus", function (t) {
				QuestionInterface.selectTextbox(t.target)
			})
		}
			.bind(this)),
		this.audioSrc = "https://prodigy.blob.core.windows.net/edu-tts-1-4-2/question/" + n + ".mp3",
		this.hintButton = this.hintButton || new QuestionInterface.Button(this.container, this.images.hint, {
				top: 110,
				right: 15
			}, s),
		this.hasLesson = o ? !0 : !1,
		this.lessonButton = this.lessonButton || new QuestionInterface.Button(this.container, this.images.lesson, {
				top: 205,
				right: 15
			}, o),
		this.addMenuButtons()
	}
	return t.prototype = Object.create(QuestionInterface.MenuScreen.prototype),
	t.prototype.isValid = function () {
		return this.controller.isValid()
	},
	t.prototype.isCorrect = function () {
		return this.controller.isCorrect()
	},
	t.prototype.setInput = function (t) {
		this.controller.setInput(t)
	},
	t.prototype.displayCorrect = function () {
		this.controller.disableInput(),
		this.controller.displayAnswer()
	},
	t.prototype.displayIncorrect = function () {
		this.controller.disableInput(),
		this.controller.displayResult()
	},
	t.prototype.getInput = function () {
		return this.controller.getInput()
	},
	t.prototype.hide = function () {
		this.inputElements.hide(),
		QuestionInterface.MenuScreen.prototype.hide.call(this)
	},
	t.prototype.deactivateButtons = function () {
		this.ttsButton.deactivate(),
		this.hintButton.deactivate(),
		this.lessonButton.deactivate()
	},
	t.prototype.reactivateButtons = function () {
		this.ttsButton.reactivate(),
		this.hintButton.reactivate(),
		this.lessonButton.reactivate()
	},
	t.prototype.show = function () {
		this.ttsButton.reactivate(),
		this.inputElements.show(),
		QuestionInterface.MenuScreen.prototype.show.call(this)
	},
	t.prototype.close = function () {
		this.inputElements.close(),
		this.inputElements = null,
		this.controller.clear(),
		this.controller = null,
		$("textarea.control").off(),
		QuestionInterface.MenuScreen.prototype.close.call(this)
	},
	t
}
(), QuestionInterface.ManipulativeMenu = function () {
	function t(t, e, i, n, s, o) {
		this.container = t,
		this.inAmerica = i,
		this.images = n,
		this.imagePath = s,
		this.skillID = e,
		this.element = document.createElement("div"),
		$(this.element).css({
			position: "relative",
			"z-index": 4,
			"-webkit-transform": "translateZ(4px)",
			"-moz-transform": "translateZ(4px)",
			"-ms-transform": "translateZ(4px)",
			transform: "translateZ(4px)",
			height: "442px",
			width: "248px",
			top: "15px",
			left: "905px",
			border: "8px solid white",
			"background-color": "rgba(255, 255, 255, 0.4)",
			"border-radius": "7px",
			"box-shadow": "0 0 4px 1px black"
		}),
		this.closeButton = new QuestionInterface.Button(this.container, this.images.exit, {
				top: 300,
				right: 15
			}, o),
		this.eraseButton = new QuestionInterface.Button(this.container, this.images.erase, {
				top: 395,
				right: 15
			}, this.erase.bind(this)),
		QuestionInterface.Manipulatives.TYPES = {
			coin: QuestionInterface.Manipulatives.Coin,
			counter: QuestionInterface.Manipulatives.Counter,
			baseBlock: QuestionInterface.Manipulatives.BaseBlock,
			fraction: QuestionInterface.Manipulatives.Fraction,
			fractionContainer: QuestionInterface.Manipulatives.FractionContainer,
			manipulative: QuestionInterface.Manipulatives.Manipulative
		},
		this.mCollection = new QuestionInterface.Manipulatives.Collection,
		this.mView = new QuestionInterface.Manipulatives.View({
				collection: this.mCollection,
				canvasWidth: 1170,
				canvasHeight: 500
			}),
		this.mDragView = new QuestionInterface.Manipulatives.DragView({
				collection: this.mCollection,
				canvasWidth: 1170,
				canvasHeight: 500
			}),
		this.menuCollection = new QuestionInterface.Manipulatives.Menu.Collection,
		this.menuView = new QuestionInterface.Manipulatives.Menu.View({
				collection: this.menuCollection,
				canvasWidth: 1170,
				canvasHeight: 500
			}),
		this.menu = document.createElement("div"),
		this.container.appendChild(this.menu),
		this.menuView.render(),
		$(this.element).on("mousedown touchstart", function (t) {
			var e = this.menuView.getClickedManipulative(t, {
					left: this.element.offsetLeft,
					top: this.element.offsetTop
				});
			e && (QuestionInterface.trackEvent(document.getElementsByClassName("qi-tab selected")[0].getAttribute("name") + "ToolUse", this.skillID), this.mCollection.selectMenuManipulative(e, t))
		}
			.bind(this)),
		$(this.element).on("mousemove touchmove", function (t) {
			this.mCollection.simulateMouseMove(t)
		}
			.bind(this)),
		$(this.element).on("mouseup touchend", function (t) {
			this.mCollection.simulateMouseUp(t, !0)
		}
			.bind(this)),
		this.container.appendChild(this.mView.el),
		this.container.appendChild(this.element),
		this.container.appendChild(this.menuView.el),
		this.container.appendChild(this.mDragView.el),
		this.drawingModel = new QuestionInterface.DrawingManipulative.Model,
		this.drawingView = new QuestionInterface.DrawingManipulative.View({
				model: this.drawingModel,
				canvasWidth: 860,
				canvasHeight: 500
			}),
		this.container.appendChild(this.drawingView.el),
		this.addDrawingColors(),
		this.addTabs()
	}
	return t.prototype = Object.create(QuestionInterface.Element.prototype),
	t.prototype.hide = function () {
		this.drawingModel.disableDrawing(),
		this.menuView.el.classList.add("hidden"),
		this.element.classList.add("hidden")
	},
	t.prototype.show = function () {
		document.getElementsByClassName("qi-tab selected drawing-tab")[0] && this.drawingModel.enableDrawing(),
		this.menuView.el.classList.remove("hidden"),
		this.element.classList.remove("hidden")
	},
	t.prototype.addTabs = function () {
		for (var t, e = [{
					name: "Draw",
					icon: "fa-pencil",
					onmouseup: this.displayDrawingTools
				}, {
					name: "Fraction",
					icon: "fa-pie-chart",
					onmouseup: this.displayFractions
				}, {
					name: "BaseBlock",
					icon: "fa-cube",
					onmouseup: this.displayBaseBlocks
				}, {
					name: "Coin",
					icon: "fa-usd",
					onmouseup: this.displayCoins
				}, {
					name: "Counter",
					icon: "fa-circle",
					onmouseup: this.displayCounters
				}
			], i = 0, n = 0; n < e.length; n++) {
			t = document.createElement("div"),
			t.className = "qi-tab",
			t.setAttribute("name", e[n].name),
			0 === n && (t.className = "qi-tab drawing-tab"),
			t.innerHTML = e[n].name;
			var s = document.createElement("i");
			s.className = "fa " + e[n].icon,
			$(t).html(s),
			function (t, i, n) {
				$(i).on("mousedown touchstart", function () {
					t.trackedEvent = !0,
					QuestionInterface.trackEvent(e[n].name + "ToolOpen", t.skillID),
					e[n].onmouseup.bind(t)(i)
				})
			}
			(this, t, n),
			t.style.top = i + "px",
			i += 65,
			0 === n && $(e[n]).on("mousedown touchstart", e[n].onmouseup.bind(this)(t)),
			this.element.appendChild(t)
		}
	},
	t.prototype.addDrawingColors = function () {
		var t,
		e = Controller.COLORS,
		i = [e.navy, e.blue, e.purple, e.teal, e.green, e.brown, e.lightred, e.orange, e.pink, e.darkgrey, e.white, null],
		n = document.createDocumentFragment();
		for (var s in i)
			t = document.createElement("div"), t.className = "qi-colorswatch", t.style.backgroundColor = i[s], i[s] || (t.style.borderColor = Controller.COLORS.lightgrey), $(t).on("mousedown touchstart", function (t, e) {
				QuestionInterface.trackEvent("DrawToolUse", this.skillID);
				var i = document.getElementsByClassName("qi-colorswatch selected")[0];
				i ? i.classList.remove("selected") : this.trackedEvent || QuestionInterface.trackEvent("DrawToolOpen", this.skillID),
				e.classList.add("selected"),
				this.drawingModel.set({
					color: t
				})
			}
				.bind(this, i[s], t)), n.appendChild(t);
		n.appendChild(t),
		this.drawingColors = document.createElement("div"),
		this.drawingColors.style.position = "relative",
		this.drawingColors.style.width = "240px",
		this.drawingColors.style.margin = "18px 4px 0px 4px",
		this.drawingColors.appendChild(n),
		this.element.appendChild(this.drawingColors)
	},
	t.prototype.selectTab = function (t) {
		t.classList.contains("drawing-tab") ? this.drawingModel.enableDrawing() : this.drawingModel.disableDrawing(),
		this.drawingColors.style.display = "none";
		var e = document.getElementsByClassName("qi-tab selected")[0];
		e && e.classList.remove("selected"),
		t.classList.add("selected")
	},
	t.prototype.displayDrawingTools = function (t) {
		this.drawingModel.enableDrawing(),
		this.selectTab(t),
		this.menuCollection.reset(),
		this.drawingColors.style.display = ""
	},
	t.prototype.displayFractions = function (t) {
		this.selectTab(t);
		var e = 918,
		i = 26;
		this.menuCollection.reset([{
					type: "fraction",
					denominator: 1,
					x: e,
					y: i
				}, {
					type: "fraction",
					denominator: 2,
					x: e,
					y: i + 44
				}, {
					type: "fraction",
					denominator: 3,
					x: e,
					y: i + 88
				}, {
					type: "fraction",
					denominator: 4,
					x: e,
					y: i + 132
				}, {
					type: "fraction",
					denominator: 5,
					x: e,
					y: i + 176
				}, {
					type: "fraction",
					denominator: 6,
					x: e,
					y: i + 220
				}, {
					type: "fraction",
					denominator: 8,
					x: e,
					y: i + 264
				}, {
					type: "fraction",
					denominator: 10,
					x: e,
					y: i + 308
				}, {
					type: "fraction",
					denominator: 12,
					x: e,
					y: i + 352
				}, {
					type: "fractionContainer",
					x: e,
					y: i + 2 + 396
				}
			])
	},
	t.prototype.displayCounters = function (t) {
		this.selectTab(t);
		var e = 958,
		i = 234;
		this.menuCollection.reset([{
					type: "counter",
					x: e,
					y: i,
					defaultColor: Controller.COLORS.blue,
					selectedColor: Controller.COLORS.lightteal
				}, {
					type: "counter",
					x: e + 80,
					y: i,
					defaultColor: Controller.COLORS.green,
					selectedColor: Controller.COLORS.lightorange
				}, {
					type: "counter",
					x: e + 160,
					y: i,
					defaultColor: Controller.COLORS.pink,
					selectedColor: Controller.COLORS.lightbrown
				}
			])
	},
	t.prototype.displayBaseBlocks = function (t) {
		this.selectTab(t);
		var e = 932,
		i = 149;
		this.menuCollection.reset([{
					type: "baseBlock",
					blockCount: 100,
					x: e,
					y: i
				}, {
					type: "baseBlock",
					blockCount: 10,
					x: e + 135 + 32,
					y: i
				}, {
					type: "baseBlock",
					blockCount: 1,
					x: e + 135 + 64,
					y: i + 85 - 16
				}
			])
	},
	t.prototype.loadCoinImages = function (t) {
		function e(i) {
			if (0 === i.length)
				this.loader.close(), this.loader = null, this.displayCoins(t);
			else {
				var n = new Image,
				s = i.pop();
				n.onload = function () {
					n.onload = null,
					e.bind(this)(i)
				}
				.bind(this),
				n.src = s
			}
		}
		this.coinImages = this.inAmerica ? {
			quarter: {
				front: this.imagePath + "manipulatives/coins/us/quarter-front.png",
				back: this.imagePath + "manipulatives/coins/us/quarter-back.png"
			},
			dime: {
				front: this.imagePath + "manipulatives/coins/us/dime-front.png",
				back: this.imagePath + "manipulatives/coins/us/dime-back.png"
			},
			nickel: {
				front: this.imagePath + "manipulatives/coins/us/nickel-front.png",
				back: this.imagePath + "manipulatives/coins/us/nickel-back.png"
			},
			penny: {
				front: this.imagePath + "manipulatives/coins/us/penny-front.png",
				back: this.imagePath + "manipulatives/coins/us/penny-back.png"
			}
		}
		 : {
			toonie: {
				front: this.imagePath + "manipulatives/coins/canada/toonie-front.png",
				back: this.imagePath + "manipulatives/coins/canada/toonie-back.png"
			},
			loonie: {
				front: this.imagePath + "manipulatives/coins/canada/loonie-front.png",
				back: this.imagePath + "manipulatives/coins/canada/loonie-back.png"
			},
			quarter: {
				front: this.imagePath + "manipulatives/coins/canada/quarter-front.png",
				back: this.imagePath + "manipulatives/coins/canada/quarter-back.png"
			},
			dime: {
				front: this.imagePath + "manipulatives/coins/canada/dime-front.png",
				back: this.imagePath + "manipulatives/coins/canada/dime-back.png"
			},
			nickel: {
				front: this.imagePath + "manipulatives/coins/canada/nickel-front.png",
				back: this.imagePath + "manipulatives/coins/canada/nickel-back.png"
			}
		},
		this.loader = new QuestionInterface.Loader(this.container, this.images),
		this.loader.element.style.left = "1012px",
		this.loader.element.style.top = "222px",
		this.loader.element.style["pointer-events"] = "none";
		var i = [];
		for (var n in this.coinImages)
			i.push(this.coinImages[n].front), i.push(this.coinImages[n].back);
		e.bind(this)(i)
	},
	t.prototype.displayCoins = function (t) {
		if (this.selectTab(t), this.coinImages)
			if (this.inAmerica) {
				var e = 1e3,
				i = 150;
				this.menuCollection.reset([{
							type: "coin",
							x: e,
							y: i - 50,
							coinFront: this.coinImages.quarter.front,
							coinBack: this.coinImages.quarter.back
						}, {
							type: "coin",
							x: e + 15,
							y: i + 35,
							coinFront: this.coinImages.dime.front,
							coinBack: this.coinImages.dime.back
						}, {
							type: "coin",
							x: e + 10,
							y: i + 90,
							coinFront: this.coinImages.nickel.front,
							coinBack: this.coinImages.nickel.back
						}, {
							type: "coin",
							x: e + 8 + 4,
							y: i + 160,
							coinFront: this.coinImages.penny.front,
							coinBack: this.coinImages.penny.back
						}
					])
			} else {
				var e = 930,
				i = 130;
				this.menuCollection.reset([{
							type: "coin",
							x: e + 25,
							y: i + 20,
							coinFront: this.coinImages.toonie.front,
							coinBack: this.coinImages.toonie.back
						}, {
							type: "coin",
							x: e + 122,
							y: i + 20,
							coinFront: this.coinImages.loonie.front,
							coinBack: this.coinImages.loonie.back
						}, {
							type: "coin",
							x: e + 145,
							y: i + 102,
							coinFront: this.coinImages.quarter.front,
							coinBack: this.coinImages.quarter.back
						}, {
							type: "coin",
							x: e + 84,
							y: i + 160,
							coinFront: this.coinImages.dime.front,
							coinBack: this.coinImages.dime.back
						}, {
							type: "coin",
							x: e + 12,
							y: i + 108,
							coinFront: this.coinImages.nickel.front,
							coinBack: this.coinImages.nickel.back
						}
					])
			}
		else
			this.menuCollection.reset(), this.loadCoinImages(t)
	},
	t.prototype.erase = function () {
		this.mCollection.reset(),
		this.drawingModel.reset()
	},
	t.prototype.close = function () {
		this.erase(),
		this.menuCollection.reset(),
		this.container.removeChild(this.menu),
		this.container.removeChild(this.mView.el),
		this.container.removeChild(this.drawingView.el),
		this.container.removeChild(this.menuView.el),
		this.element.removeChild(this.drawingColors),
		this.container.removeChild(this.mDragView.el),
		this.eraseButton.close(),
		this.closeButton.close(),
		QuestionInterface.Element.prototype.close.call(this)
	},
	t
}
(), QuestionInterface.DialogueMenu = function () {
	function t(t, e, i) {
		this.container = t,
		this.element = document.createElement("div"),
		this.dialogue = i,
		this.dialogueBox = document.createElement("div"),
		this.dialogueBox.className = "qi-npc-dialogue qi-text hidden",
		this.npc = new Image,
		$(this.npc).css({
			position: "absolute",
			left: "185px",
			bottom: "750px",
			"z-index": 7,
			"-webkit-transform": "translateZ(7px)",
			"-moz-transform": "translateZ(7px)",
			"-ms-transform": "translateZ(7px)",
			transform: "translateZ(7px)"
		}),
		this.npc.draggable = !1,
		this.npc.className = "hidden",
		this.npc.onload = function () {
			$(this.dialogueBox).animate({
				bottom: "750px"
			}, 500).animate({
				bottom: "522px"
			}, 500),
			$(this.npc).animate({
				bottom: "750px"
			}, 500).animate({
				bottom: "522px"
			}, 500),
			this.advanceDialogue(0)
		}
		.bind(this),
		this.npc.src = e + "core/npc.png",
		this.nextButton = document.createElement("div"),
		$(this.nextButton).css({
			"z-index": 10,
			position: "absolute",
			height: "70px",
			width: "70px",
			"background-color": "#6282f6",
			"border-radius": "70px",
			border: "5px solid white",
			"box-shadow": "0 0 0 1px black",
			"margin-left": "636px",
			color: "white",
			"line-height": "70px",
			"text-align": "center",
			"font-size": "25px",
			"pointer-events": "none",
			bottom: "-10px"
		}),
		this.nextButton.innerHTML = "NEXT",
		this.element.appendChild(this.dialogueBox),
		this.element.appendChild(this.npc),
		this.container.appendChild(this.element)
	}
	return t.prototype = Object.create(QuestionInterface.Element.prototype),
	t.prototype.addDialogueBoxListener = function () {
		$(this.dialogueBox).on("mousedown touchstart", function () {
			$(this.dialogueBox).off(),
			this.autoAdvancing ? this.stopAutoAdvance() : this.advanceDialogue.bind(this)()
		}
			.bind(this))
	},
	t.prototype.startNewDialogue = function (t) {
		this.dialogueIndex >= this.dialogue.length && (this.dialogue = t, this.dialogueIndex = 0, this.advanceDialogue(0))
	},
	t.prototype.startAutoAdvance = function () {
		this.autoAdvancing || (this.advanceDialogue(), this.autoAdvance = setInterval(this.advanceDialogue.bind(this), 15e3), this.autoAdvancing = !0)
	},
	t.prototype.stopAutoAdvance = function () {
		this.autoAdvancing = !1,
		clearInterval(this.autoAdvance)
	},
	t.prototype.changeDialogue = function () {
		this.dialogueIndex = this.dialogueIndex || 0,
		this.dialogueBox.innerHTML = this.dialogue[this.dialogueIndex],
		this.dialogueBox.appendChild(this.nextButton),
		this.dialogueIndex++,
		this.addDialogueBoxListener()
	},
	t.prototype.advanceDialogue = function (t) {
		this.dialogueBox.className = "qi-npc-dialogue qi-text",
		this.npc.className = "",
		this.dialogueIndex = this.dialogueIndex || 0,
		t = t || 0,
		0 === this.dialogueIndex ? ($(this.dialogueBox).delay(t).animate({
				bottom: "522px"
			}, 500), $(this.npc).delay(t).animate({
				bottom: "522px"
			}, 500), this.changeDialogue()) : this.dialogueIndex < this.dialogue.length ? ($(this.dialogueBox).animate({
				bottom: "750px"
			}, 500, this.changeDialogue.bind(this)).animate({
				bottom: "522px"
			}, 500), $(this.npc).animate({
				bottom: "750px"
			}, 500).animate({
				bottom: "522px"
			}, 500)) : ($(this.dialogueBox).animate({
				bottom: "750px"
			}, 500), $(this.npc).animate({
				bottom: "750px"
			}, 500))
	},
	t.prototype.close = function () {
		this.stopAutoAdvance(),
		$(this.dialogueBox).off(),
		$(this.element).empty(),
		QuestionInterface.Element.prototype.close.call(this)
	},
	t
}
(), QuestionInterface.LoadingMenu = function () {
	function t(t, e) {
		this.container = t,
		this.images = e,
		this.element = document.createElement("div"),
		this.loadingNotice = document.createElement("div"),
		this.loadingNotice.className = "qi-text qi-pulse",
		this.loadingNotice.innerHTML = "LOADING...",
		$(this.loadingNotice).css({
			height: "160px",
			width: "240px",
			"line-height": "160px",
			position: "absolute",
			top: "50%",
			left: "50%",
			transform: "translate(-50%,-50%)",
			"-webkit-transform": "translate(-50%,-50%)",
			"-moz-transform": "translate(-50%,-50%)",
			"-ms-transform": "translate(-50%,-50%)",
			"text-align": "center"
		}),
		$(this.loadingNotice).fadeIn(1e3),
		this.element.appendChild(this.loadingNotice),
		this.container.appendChild(this.element)
	}
	return t.prototype = Object.create(QuestionInterface.Element.prototype),
	t.prototype.fadeInBackground = function () {
		for (var t, e = document.createDocumentFragment(), i = 0; 720 > i; i += 80)
			for (var n = 0; 1280 > n; n += 80)
				t = new Image, t.src = this.images.bg, t.className = "qi-bgtile", $(t).css({
					display: "none",
					position: "absolute",
					top: i + "px",
					left: n + "px",
					width: "80px",
					height: "80px"
				}), e.appendChild(t), $(t).fadeIn(100 * Math.floor(9 * Math.random()));
		this.element.appendChild(e),
		setTimeout(this.close.bind(this), 800)
	},
	t.prototype.close = function () {
		$(this.loadingNotice).finish(),
		$(this.container).css({
			"animation-name": "animatedBackground",
			animation: "animatedBackground 80s linear infinite",
			"-moz-animation": "animatedBackground 80s linear infinite",
			"-webkit-animation": "animatedBackground 80s linear infinite",
			"background-image": 'url("' + this.images.bg + '")'
		}),
		QuestionInterface.Element.prototype.close.call(this)
	},
	t
}
(), QuestionInterface.Manipulatives = QuestionInterface.Manipulatives || {}, QuestionInterface.Manipulatives.normalizeEvents = function (t) {
	return t = t.originalEvent || t,
	t = t.touches || t.changedTouches ? t.touches[0] || t.changedTouches[0] : t
}, QuestionInterface.Manipulatives.getEventCoordinates = function (t, e) {
	t = QuestionInterface.Manipulatives.normalizeEvents(t);
	var e = e || {
		top: 0,
		left: 0
	},
	i = $(".question-interface").parent();
	return {
		x: (t.pageX - e.left) / (i.innerWidth() / 1280),
		y: (t.pageY - e.top) / ((i.innerHeight() || window.innerHeight) / 720)
	}
}, QuestionInterface.Manipulatives.Collection = Backbone.Collection.extend({
		initialize: function () {
			this.listenTo(this, "add-manipulatives", this.addManipulatives),
			this.listenTo(this, "focus-manipulatives", this.focusManipulatives),
			this.styleTop = "15px",
			this.styleLeft = "15px"
		},
		addManipulatives: function (t) {
			this.add(t)
		},
		focusManipulatives: function (t) {
			this.remove(t),
			this.add(t)
		},
		model: function (t, e) {
			return QuestionInterface.Manipulatives.TYPES[t.type] ? new QuestionInterface.Manipulatives.TYPES[t.type].Model(t, e) : (console.warn("No model defined for control of type " + t.type), new QuestionInterface.Manipulatives.TYPES.manipulative.Model(t, e))
		},
		containsPoint: function (t, e) {
			return this.filter(function (i) {
				return i.containsPoint(t, e) && !i.unselectable
			})
		},
		intersect: function (t) {
			return t.intersect ? this.filter(function (e) {
				return t.intersect(e)
			}) : []
		},
		selectMenuManipulative: function (t, e) {
			this.deselectManipulative(),
			this.selectManipulative(e, t.clone())
		},
		addManipulativeAtMenuSide: function () {
			if (this.selectedManipulative) {
				var t = this.selectedManipulative.get("w") || this.selectedManipulative.get("radius") || 0;
				this.selectedManipulative.set({
					x: 840 - t
				}),
				this.add(this.selectedManipulative),
				this.deselectManipulative()
			}
		},
		simulateMouseMove: function (t) {
			t = QuestionInterface.Manipulatives.normalizeEvents(t),
			this.selectedManipulative && (this.dragged ? this.dragManipulative({
					pageX: t.pageX,
					pageY: t.pageY
				}) : this.checkManipulativeDragged(t))
		},
		simulateMouseUp: function (t) {
			t = QuestionInterface.Manipulatives.normalizeEvents(t),
			this.dragged ? this.dropManipulative({
				pageX: t.pageX,
				pageY: t.pageY
			}) : this.contains(this.selectedManipulative) ? this.clickManipulative({
				pageX: t.pageX,
				pageY: t.pageY
			}) : this.addManipulativeAtMenuSide()
		},
		selectManipulative: function (t, e) {
			var i = QuestionInterface.Manipulatives.getEventCoordinates(t);
			this.mouseX = i.x,
			this.mouseY = i.y,
			this.mousedownX = this.mouseX,
			this.mousedownY = this.mouseY,
			e ? this.selectedManipulative = e : (manipulatives = this.containsPoint(this.mouseX, this.mouseY), this.selectedManipulative = manipulatives[manipulatives.length - 1]),
			this.dragged = !1
		},
		checkManipulativeDragged: function (t) {
			if (this.selectedManipulative && this.selectedManipulative.drag) {
				var e = QuestionInterface.Manipulatives.getEventCoordinates(t),
				i = e.x,
				n = e.y,
				s = 5;
				(Math.abs(this.mousedownX - i) > s || Math.abs(this.mousedownY - n) > s) && (this.trigger("drag-start", t), this.dragged = !0, this.remove(this.selectedManipulative))
			}
		},
		clickManipulative: function (t) {
			if (this.selectedManipulative) {
				if (this.selectedManipulative.click) {
					var e = QuestionInterface.Manipulatives.getEventCoordinates(t);
					this.selectedManipulative.click(e.x, e.y)
				}
				this.deselectManipulative()
			}
		},
		dragManipulative: function (t) {
			var e = QuestionInterface.Manipulatives.getEventCoordinates(t);
			if (this.selectedManipulative && this.selectedManipulative.drag) {
				var i = e.x,
				n = e.y;
				this.selectedManipulative.drag(i - this.mouseX, n - this.mouseY),
				this.trigger("drag-manipulative"),
				this.mouseX = i,
				this.mouseY = n
			}
		},
		dropManipulative: function () {
			if (this.selectedManipulative && (this.trigger("drag-stop"), this.selectedManipulative.intersect && this.selectedManipulative.drop)) {
				var t = this.intersect(this.selectedManipulative),
				e = t[t.length - 1];
				if (e)
					return this.selectedManipulative.drop(e), "fractionContainer" === this.selectedManipulative.get("type") && this.add(this.selectedManipulative), this.deselectManipulative(), void this.trigger("drag-stop")
			}
			this.add(this.selectedManipulative),
			this.deselectManipulative(),
			this.trigger("drag-stop")
		},
		mouseleave: function () {},
		deselectManipulative: function () {
			this.selectedManipulative && (this.selectedManipulative = null)
		}
	}), QuestionInterface.Manipulatives = QuestionInterface.Manipulatives || {}, QuestionInterface.Manipulatives.View = Backbone.View.extend({
		tagName: "canvas",
		className: "qi-canvas",
		initialize: function (t) {
			this.views = [],
			this.el.style["z-index"] = 0,
			this.el.width = t.canvasWidth,
			this.el.height = t.canvasHeight,
			this.listenTo(this.collection, "reset", this.render),
			this.listenTo(this.collection, "remove", this.render),
			this.listenTo(this.collection, "add", this.render),
			this.listenTo(this.collection, "change", this.render),
			this.listenTo(this.collection, "drag-stop", this.render)
		},
		events: {
			mousedown: "selectManipulative",
			mousemove: "checkManipulativeDragged",
			mouseup: "simulateMouseUp",
			mouseleave: "mouseleave",
			touchstart: "selectManipulative",
			touchmove: "simulateMouseMove",
			touchend: "simulateMouseUp"
		},
		simulateMouseMove: function (t) {
			this.collection.simulateMouseMove(t)
		},
		simulateMouseUp: function (t) {
			this.collection.simulateMouseUp(t)
		},
		selectManipulative: function (t) {
			this.collection.selectManipulative(t)
		},
		checkManipulativeDragged: function (t) {
			this.collection.checkManipulativeDragged(t, this.$el.offset())
		},
		mouseleave: function () {
			this.collection.mouseleave()
		},
		render: function () {
			var t = this.el.getContext("2d");
			for (t.clearRect(0, 0, this.el.width, this.el.height); this.views.length > 0; )
				this.views.pop().remove();
			this.collection.forEach(this.addManipulative, this)
		},
		addManipulative: function (t) {
			var e,
			i = this.el.getContext("2d");
			QuestionInterface.Manipulatives.TYPES[t.get("type")] ? e = new(QuestionInterface.Manipulatives.TYPES[t.get("type")].View)({
					context: i,
					model: t
				}) : (console.warn("No view defined for manipulative of type " + t.get("type")), e = new QuestionInterface.Manipulatives.TYPES.manipulative.View({
							context: i,
							model: t
						})),
			e.render(),
			this.views.push(e)
		},
		remove: function (t) {
			for (; this.views.length > 0; )
				this.views.pop().remove();
			Backbone.View.prototype.remove.apply(this, t)
		}
	}), QuestionInterface.Manipulatives = QuestionInterface.Manipulatives || {}, QuestionInterface.Manipulatives.DragView = Backbone.View.extend({
		tagName: "canvas",
		className: "qi-canvas",
		initialize: function (t) {
			this.views = [],
			$(this.el).css({
				"z-index": 6,
				"-webkit-transform": "translateZ(6px)",
				"-moz-transform": "translateZ(6px)",
				"-ms-transform": "translateZ(6px)",
				transform: "translateZ(6px)"
			}),
			this.el.width = t.canvasWidth,
			this.el.height = t.canvasHeight,
			this.context = this.el.getContext("2d"),
			this.context.globalAlpha = .6,
			this.listenTo(this.collection, "reset", this.render),
			this.listenTo(this.collection, "drag-start", this.show),
			this.listenTo(this.collection, "drag-start", this.render),
			this.listenTo(this.collection, "drag-manipulative", this.render),
			this.listenTo(this.collection, "drag-stop", this.hide),
			this.hide()
		},
		events: {
			mousemove: "dragManipulative",
			mouseup: "dropManipulative",
			mouseenter: "mouseenter"
		},
		simulateTouchStart: function (t) {
			var e = QuestionInterface.Manipulatives.getEventCoordinates(t),
			i = $.Event("touchstart", {
					pageX: e.x,
					pageY: e.y
				});
			this.$el.trigger(i)
		},
		dragManipulative: function (t) {
			this.collection.dragManipulative(t, this.$el.offset())
		},
		show: function () {
			this.el.style.display = ""
		},
		hide: function () {
			this.el.style.display = "none"
		},
		dropManipulative: function () {
			this.collection.dropManipulative()
		},
		mouseenter: function (t) {
			t.which || this.collection.dropManipulative()
		},
		clearCanvas: function () {
			var t = this.el.getContext("2d");
			t.clearRect(0, 0, this.el.width, this.el.height)
		},
		render: function () {
			for (this.clearCanvas(); this.views.length > 0; )
				this.views.pop().remove();
			this.collection.selectedManipulative && this.addManipulative(this.collection.selectedManipulative)
		},
		addManipulative: function (t) {
			var e,
			i = this.el.getContext("2d");
			QuestionInterface.Manipulatives.TYPES[t.get("type")] ? e = new(QuestionInterface.Manipulatives.TYPES[t.get("type")].View)({
					context: i,
					model: t
				}) : (console.warn("No view defined for manipulative of type " + t.get("type")), e = new QuestionInterface.Manipulatives.TYPES.manipulative.View({
							context: i,
							model: t
						})),
			e.render(),
			this.views.push(e)
		},
		remove: function (t) {
			for (; this.views.length > 0; )
				this.views.pop().remove();
			Backbone.View.prototype.remove.apply(this, t)
		}
	}), QuestionInterface.Manipulatives = QuestionInterface.Manipulatives || {}, QuestionInterface.Manipulatives.Menu = {
	Collection: Backbone.Collection.extend({
		intialize: function () {
			this.styleTop = "15px",
			this.styleLeft = "15px"
		},
		model: function (t, e) {
			return QuestionInterface.Manipulatives.TYPES[t.type] ? new QuestionInterface.Manipulatives.TYPES[t.type].Model(t, e) : (console.warn("No model defined for control of type " + t.type), new QuestionInterface.Manipulatives.TYPES.manipulative.Model(t, e))
		},
		getClickedManipulative: function (t) {
			var e = QuestionInterface.Manipulatives.getEventCoordinates(t);
			return this.filter(function (t) {
				return t.containsPoint(e.x, e.y)
			})[0]
		}
	}),
	View: Backbone.View.extend({
		tagName: "canvas",
		className: "qi-canvas",
		initialize: function (t) {
			this.views = [],
			this.$el.css({
				"z-index": 6,
				"-webkit-transform": "translateZ(6px)",
				"-moz-transform": "translateZ(6px)",
				"-ms-transform": "translateZ(6px)",
				transform: "translateZ(6px)",
				"pointer-events": "none"
			}),
			this.el.width = t.canvasWidth,
			this.el.height = t.canvasHeight,
			this.listenTo(this.collection, "reset", this.render)
		},
		getClickedManipulative: function (t) {
			var e = this.$el.offset();
			return this.collection.getClickedManipulative(t, e)
		},
		render: function () {
			var t = this.el.getContext("2d");
			for (t.clearRect(0, 0, this.el.width, this.el.height); this.views.length > 0; )
				this.views.pop().remove();
			this.collection.forEach(this.addManipulative, this)
		},
		addManipulative: function (t) {
			var e,
			i = this.el.getContext("2d");
			QuestionInterface.Manipulatives.TYPES[t.get("type")] ? e = new(QuestionInterface.Manipulatives.TYPES[t.get("type")].View)({
					context: i,
					model: t
				}) : (console.warn("No view defined for manipulative of type " + t.get("type")), e = new QuestionInterface.Manipulatives.TYPES.manipulative.View({
							context: i,
							model: t
						})),
			e.render(),
			this.views.push(e)
		}
	})
}, QuestionInterface.Manipulatives.Manipulative = {
	Model: Backbone.Model.extend({
		defaults: {
			x: 1e3,
			y: 0,
			w: 0,
			h: 0,
			strokeStyle: Controller.COLORS.black,
			lineWidth: 1
		},
		drag: function (t, e) {
			this.set({
				x: this.get("x") + t
			}),
			this.set({
				y: this.get("y") + e
			})
		},
		containsPoint: function (t, e) {
			return this.get("x") <= t && t <= this.get("x") + this.get("w") && this.get("y") <= e && e <= this.get("y") + this.get("h")
		}
	}),
	View: Backbone.View.extend({
		initialize: function (t) {
			this.context = t.context,
			this.listenTo(this.model, "change", this.render),
			this.listenTo(this.model, "render", this.render)
		},
		render: function () {
			this.model.get("fillStyle") && (this.context.fillStyle = this.model.get("fillStyle"), this.context.fill()),
			this.model.get("lineWidth") > 0 && (this.context.save(), this.context.strokeStyle = this.model.get("strokeStyle"), this.context.lineWidth = this.model.get("lineWidth"), this.context.stroke(), this.context.restore())
		}
	})
}, QuestionInterface.Manipulatives.Coin = {
	Model: QuestionInterface.Manipulatives.Manipulative.Model.extend({
		initialize: function () {
			this.coinFront = new Image,
			this.coinBack = new Image,
			this.set({
				coin: this.coinFront
			}),
			QuestionInterface.Manipulatives.Manipulative.Model.prototype.initialize.apply(this)
		},
		containsPoint: function (t, e) {
			var i = Math.max(this.get("w"), this.get("h")) / 2,
			n = t - (this.get("x") + this.get("w") / 2),
			s = e - (this.get("y") + this.get("h") / 2);
			return i * i >= n * n + s * s
		},
		click: function () {
			var t = this.get("coin") === this.coinFront ? this.coinBack : this.coinFront;
			this.set({
				coin: t
			})
		}
	}),
	View: QuestionInterface.Manipulatives.Manipulative.View.extend({
		initialize: function (t) {
			this.model.coinFront.onload = function () {
				this.model.set({
					w: this.model.coinFront.width
				}),
				this.model.set({
					h: this.model.coinFront.height
				}),
				this.model.coinFront.onload = null
			}
			.bind(this),
			this.model.coinFront.src = this.model.get("coinFront"),
			this.model.coinBack.src = this.model.get("coinBack"),
			QuestionInterface.Manipulatives.Manipulative.View.prototype.initialize.call(this, t)
		},
		render: function () {
			this.context.drawImage(this.model.get("coin"), this.model.get("x"), this.model.get("y"))
		}
	})
}, QuestionInterface.Manipulatives.Counter = {
	Model: QuestionInterface.Manipulatives.Manipulative.Model.extend({
		defaults: {
			radius: 35,
			strokeStyle: Controller.COLORS.black,
			lineWidth: 1
		},
		initialize: function () {
			this.set({
				fillStyle: this.get("defaultColor")
			}),
			QuestionInterface.Manipulatives.Manipulative.Model.prototype.initialize.apply(this)
		},
		containsPoint: function (t, e) {
			var i = t - this.get("x"),
			n = e - this.get("y");
			return i * i + n * n <= this.get("radius") * this.get("radius")
		},
		click: function () {
			var t = this.get(this.get("fillStyle") === this.get("defaultColor") ? "selectedColor" : "defaultColor");
			this.set({
				fillStyle: t
			})
		}
	}),
	View: QuestionInterface.Manipulatives.Manipulative.View.extend({
		render: function () {
			this.context.beginPath(),
			this.context.arc(this.model.get("x"), this.model.get("y"), this.model.get("radius"), 0, 2 * Math.PI, !1),
			this.context.closePath(),
			QuestionInterface.Manipulatives.Manipulative.View.prototype.render.apply(this)
		}
	})
}, QuestionInterface.Manipulatives.BaseBlock = {
	Model: QuestionInterface.Manipulatives.Manipulative.Model.extend({
		defaults: {
			blockWidth: 15,
			blockHeight: 15,
			blockCount: 1,
			fillStyle: Controller.COLORS.lightorange,
			strokeStyle: Controller.COLORS.black,
			lineWidth: 1
		},
		initialize: function () {
			this.updateDimensions(),
			QuestionInterface.Manipulatives.Manipulative.Model.prototype.initialize.apply(this)
		},
		updateDimensions: function () {
			var t = this.get("blockCount");
			this.set({
				w: this.get("blockWidth") * Math.ceil(t / 10)
			}),
			this.set({
				h: this.get("blockHeight") * (10 >= t ? t : 10)
			})
		},
		click: function () {
			var t = this.get("blockCount");
			if (!(1 >= t)) {
				for (var e = 10 === t ? 0 : Math.floor(t / 10), i = 10 === t ? 10 : t % 10, n = this.get("x"), s = this.get("y"), o = [], a = 0; e > a; a++)
					o.push({
						type: "baseBlock",
						x: n,
						y: s,
						blockCount: 10
					}), n += this.get("blockWidth") + 10;
				for (var a = 0; i > a; a++)
					o.push({
						type: "baseBlock",
						x: n,
						y: s,
						blockCount: 1
					}), s += this.get("blockHeight") + 10;
				this.trigger("add-manipulatives", o),
				this.destroy()
			}
		},
		addBlocks: function (t) {
			t = this.get("blockCount") + t;
			var e = t % 10,
			i = t % 100 - e,
			n = t - i - e,
			s = this.get("x"),
			o = this.get("y"),
			a = this.get("blockWidth"),
			l = [];
			if (n > 0)
				for (; n > 0; )
					l.push({
						type: "baseBlock",
						x: s,
						y: o,
						blockCount: 100
					}), s += 10 * a + 10, n -= 100;
			if (i > 0 && (l.push({
						type: "baseBlock",
						x: s,
						y: o,
						blockCount: i
					}), s += a * i / 10 + 10), 0 === i && e > 0)
				l.push({
					type: "baseBlock",
					x: s,
					y: o,
					blockCount: e
				});
			else
				for (var h = 0; e > h; h++)
					l.push({
						type: "baseBlock",
						x: s,
						y: o,
						blockCount: 1
					}), o += this.get("blockHeight") + 10;
			this.trigger("add-manipulatives", l),
			this.destroy()
		},
		addManipulatives: function (t, e, i) {
			for (var n = Math.floor(i / 10), s = i % 10, t = this.get("x"), e = this.get("y"), o = [], a = 0; n > a; a++)
				o.push({
					type: "baseBlock",
					x: t,
					y: e,
					blockCount: 10
				}), t += this.get("blockWidth") + 10;
			for (var a = 0; s > a; a++)
				o.push({
					type: "baseBlock",
					x: t,
					y: e,
					blockCount: 1
				}), e += this.get("blockHeight") + 10;
			this.trigger("add-manipulatives", o)
		},
		intersect: function (t) {
			return "baseBlock" === t.get("type") && this !== t && !(t.get("x") > this.get("x") + this.get("w") || t.get("x") + t.get("w") < this.get("x") || t.get("y") > this.get("y") + this.get("h") || t.get("y") + t.get("h") < this.get("y"))
		},
		drop: function (t) {
			t.addBlocks(this.get("blockCount")),
			this.destroy()
		}
	}),
	View: QuestionInterface.Manipulatives.Manipulative.View.extend({
		render: function () {
			var t = this.model.get("x"),
			e = this.model.get("y"),
			i = this.model.get("blockHeight"),
			n = this.model.get("blockWidth");
			this.context.beginPath();
			for (var s = 0; s < this.model.get("blockCount"); s++)
				this.context.rect(t + Math.floor(s / 10) * n, e + s % 10 * i, n, i);
			this.context.closePath(),
			QuestionInterface.Manipulatives.Manipulative.View.prototype.render.apply(this)
		}
	})
}, QuestionInterface.Manipulatives.Fraction = {
	Model: QuestionInterface.Manipulatives.Manipulative.Model.extend({
		defaults: {
			h: 40,
			textColor: Controller.COLORS.white,
			strokeStyle: Controller.COLORS.black,
			lineWidth: 1,
			denominator: 1
		},
		parse: function () {},
		initialize: function () {
			this.updateWidth();
			var t,
			e = Controller.COLORS;
			switch (this.get("denominator")) {
			case 1:
				t = e.lightnavy;
				break;
			case 2:
				t = e.darkblue;
				break;
			case 3:
				t = e.lightteal;
				break;
			case 4:
				t = e.darkgreen;
				break;
			case 5:
				t = e.lightbrown;
				break;
			case 6:
				t = e.orange;
				break;
			case 8:
				t = e.pink;
				break;
			case 10:
				t = e.lightred;
				break;
			case 12:
				t = e.darkpurple
			}
			this.set({
				fillStyle: t
			}),
			QuestionInterface.Manipulatives.Manipulative.Model.prototype.initialize.apply(this)
		},
		updateWidth: function () {
			var t = this.get("denominator");
			this.set({
				w: 240 / t
			})
		},
		intersect: function (t) {
			return "fractionContainer" === t.get("type") && t.canAdd(this) && !(t.get("x") > this.get("x") + this.get("w") || t.get("x") + t.get("w") < this.get("x") || t.get("y") > this.get("y") + this.get("h") || t.get("y") + t.get("h") < this.get("y"))
		},
		drop: function (t) {
			t.addFraction(this)
		}
	}),
	View: QuestionInterface.Manipulatives.Manipulative.View.extend({
		render: function () {
			this.model.get("x"),
			this.model.get("y");
			this.context.beginPath(),
			this.context.rect(this.model.get("x"), this.model.get("y"), this.model.get("w"), this.model.get("h")),
			this.context.closePath(),
			QuestionInterface.Manipulatives.Manipulative.View.prototype.render.apply(this),
			this.context.fillStyle = this.model.get("textColor"),
			this.context.font = "bold 18px monospace",
			this.context.textAlign = "center",
			this.context.textBaseline = "middle",
			this.context.strokeStyle = this.model.get("strokeStyle"),
			this.context.fillText(1, this.model.get("x") + this.model.get("w") / 2, this.model.get("y") + .26 * this.model.get("h")),
			this.context.fillText("_", this.model.get("x") + this.model.get("w") / 2, this.model.get("y") + .26 * this.model.get("h")),
			this.context.fillText(this.model.get("denominator"), this.model.get("x") + this.model.get("w") / 2, this.model.get("y") + .7 * this.model.get("h"))
		}
	})
}, QuestionInterface.Manipulatives.FractionCollection = {
	Collection: Backbone.Collection.extend({
		model: QuestionInterface.Manipulatives.Fraction.Model,
		changeX: function (t) {
			this.forEach(function (e) {
				e.set({
					x: t
				}, {
					silent: !0
				}),
				t += e.get("w")
			})
		},
		changeY: function (t) {
			this.forEach(function (e) {
				e.set({
					y: t
				}, {
					silent: !0
				})
			})
		},
		containsPoint: function (t, e) {
			return this.filter(function (i) {
				return i.containsPoint(t, e)
			})
		}
	}),
	View: Backbone.View.extend({
		initialize: function (t) {
			this.views = [],
			this.context = t.context
		},
		render: function () {
			for (; this.views.length > 0; )
				this.views.pop().remove();
			this.collection.forEach(this.addFraction, this)
		},
		addFraction: function (t) {
			var e = new QuestionInterface.Manipulatives.Fraction.View({
					context: this.context,
					model: t
				});
			e.render(),
			this.views.push(e)
		},
		remove: function (t) {
			for (; this.views.length > 0; )
				this.views.pop().remove();
			Backbone.View.prototype.remove.apply(this, t)
		}
	})
}, QuestionInterface.Manipulatives.FractionContainer = {
	Model: QuestionInterface.Manipulatives.Manipulative.Model.extend({
		defaults: {
			x: 0,
			y: 0,
			h: 40,
			w: 240,
			strokeStyle: Controller.COLORS.darkgrey,
			lineWidth: 4
		},
		initialize: function () {
			this.remainingSpace = this.get("w"),
			this.collection = new QuestionInterface.Manipulatives.FractionCollection.Collection,
			this.listenTo(this, "change:x", this.changeX),
			this.listenTo(this, "change:y", this.changeY),
			QuestionInterface.Manipulatives.Manipulative.Model.prototype.initialize.apply(this)
		},
		changeX: function () {
			this.collection.changeX(this.get("x"))
		},
		changeY: function () {
			this.collection.changeY(this.get("y"))
		},
		canAdd: function (t) {
			return this.remainingSpace - t.get("w") >= 0
		},
		addFraction: function (t) {
			this.remainingSpace -= t.get("w"),
			this.collection.add(t),
			this.changeX(),
			this.changeY(),
			0 === this.remainingSpace && this.set({
				strokeStyle: "darkseagreen"
			}),
			this.trigger("focus-manipulatives", this)
		},
		intersect: function (t) {
			return "fractionContainer" === t.get("type") && t !== this && !(t.get("x") > this.get("x") + this.get("w") || t.get("x") + t.get("w") < this.get("x") || t.get("y") > this.get("y") + this.get("h") || t.get("y") + t.get("h") < this.get("y"))
		},
		drop: function (t) {
			this.set({
				x: t.get("x")
			}),
			this.set({
				y: t.get("y") + t.get("h") + 10
			})
		},
		click: function (t, e) {
			var i = this.collection.containsPoint(t, e)[0];
			i && (this.remainingSpace += i.get("w"), this.set({
					strokeStyle: Controller.COLORS.darkgrey
				}), this.collection.remove(i), this.changeX(), i.set({
					y: i.get("y") + i.get("h") + 10
				}), this.trigger("add-manipulatives", i.attributes), i.destroy())
		}
	}),
	View: QuestionInterface.Manipulatives.Manipulative.View.extend({
		initialize: function (t) {
			QuestionInterface.Manipulatives.Manipulative.View.prototype.initialize.call(this, t),
			this.collectionsView = new QuestionInterface.Manipulatives.FractionCollection.View({
					collection: this.model.collection,
					context: this.context
				})
		},
		render: function () {
			this.collectionsView.render(),
			this.setElement(this.collectionsView.el),
			this.context.beginPath(),
			this.context.rect(this.model.get("x") + 1, this.model.get("y") + 1, this.model.get("w") - 2, this.model.get("h") - 2),
			this.context.closePath(),
			this.context.strokeStyle = this.model.get("strokeStyle"),
			this.context.lineWidth = this.model.get("lineWidth"),
			this.model.remainingSpace === this.model.get("w") && (this.context.fillStyle = this.model.get("strokeStyle"), this.context.font = "bold 18px monospace", this.context.textAlign = "center", this.context.textBaseline = "middle", this.context.strokeStyle = this.model.get("strokeStyle"), this.context.fillText("container", this.model.get("x") + this.model.get("w") / 2, this.model.get("y") + this.model.get("h") / 2)),
			QuestionInterface.Manipulatives.Manipulative.View.prototype.render.apply(this)
		}
	})
}, QuestionInterface.DrawingManipulative = {
	Model: Backbone.Model.extend({
		enableDrawing: function () {
			this.trigger("enable-drawing")
		},
		disableDrawing: function () {
			this.trigger("disable-drawing")
		},
		mousedown: function (t, e) {
			this.set({
				x2: t
			}),
			this.set({
				y2: e
			}),
			this.unset("x1"),
			this.unset("y1"),
			this.trigger("draw")
		},
		mousemove: function (t, e) {
			this.set({
				x1: this.get("x2")
			}),
			this.set({
				y1: this.get("y2")
			}),
			this.set({
				x2: t
			}),
			this.set({
				y2: e
			}),
			this.trigger("draw")
		},
		mouseup: function () {
			this.unset("x1"),
			this.unset("y1"),
			this.unset("x2"),
			this.unset("y2")
		},
		reset: function () {
			this.trigger("clear-canvas")
		}
	}),
	View: Backbone.View.extend({
		tagName: "canvas",
		className: "qi-drawing-canvas",
		initialize: function (t) {
			this.el.width = t.canvasWidth,
			this.el.height = t.canvasHeight,
			this.context = this.el.getContext("2d"),
			this.context.lineCap = "round",
			this.context.lineJoin = "round",
			this.changeColor(),
			this.listenTo(this.model, "draw", this.render),
			this.listenTo(this.model, "change:color", this.changeColor),
			this.listenTo(this.model, "disable-drawing", this.disableDrawing),
			this.listenTo(this.model, "enable-drawing", this.enableDrawing),
			this.listenTo(this.model, "clear-canvas", this.clearCanvas)
		},
		events: {
			mousedown: "mousedown",
			mousemove: "mousemove",
			mouseup: "mouseup",
			mouseenter: "mouseenter",
			touchstart: "mousedown",
			touchmove: "mousemove",
			touchend: "mouseup"
		},
		enableDrawing: function () {
			this.el.style.pointerEvents = "",
			this.delegateEvents()
		},
		disableDrawing: function () {
			this.el.style.pointerEvents = "none",
			this.undelegateEvents()
		},
		mousedown: function (t) {
			var e = QuestionInterface.Manipulatives.getEventCoordinates(t);
			this.mouseX = e.x,
			this.mouseY = e.y,
			this.model.mousedown(this.mouseX, this.mouseY)
		},
		mousemove: function (t) {
			if (this.mouseX && this.mouseY) {
				var e = QuestionInterface.Manipulatives.getEventCoordinates(t);
				this.model.mousemove(e.x, e.y)
			}
		},
		mouseup: function () {
			this.mouseX = null,
			this.mouseY = null,
			this.model.mouseup()
		},
		mouseenter: function (t) {
			t.which || this.mouseup(t)
		},
		changeColor: function () {
			this.model.get("color") ? (this.context.globalCompositeOperation = "source-over", this.context.fillStyle = this.model.get("color"), this.context.strokeStyle = this.model.get("color"), this.model.set({
					size: 6
				})) : (this.context.globalCompositeOperation = "destination-out", this.context.fillStyle = "rgba(0,0,0,1)", this.context.strokeStyle = "rgba(0,0,0,1)", this.model.set({
					size: 10
				}))
		},
		clearCanvas: function () {
			this.context.clearRect(0, 0, this.el.width, this.el.height)
		},
		render: function () {
			this.model.get("x1") || this.model.get("y1") ? this.model.get("x1") && this.model.get("y1") && (this.context.lineWidth = this.model.get("size"), this.context.beginPath(), this.context.moveTo(this.model.get("x1"), this.model.get("y1")), this.context.lineTo(this.model.get("x2"), this.model.get("y2")), this.context.closePath(), this.context.stroke()) : (this.context.beginPath(), this.context.arc(this.model.get("x2"), this.model.get("y2"), this.model.get("size") / 2, 0, 2 * Math.PI, !1), this.context.fill())
		}
	})
}, QuestionInterface.Manipulatives.TYPES = {
	coin: QuestionInterface.Manipulatives.Coin,
	counter: QuestionInterface.Manipulatives.Counter,
	baseBlock: QuestionInterface.Manipulatives.BaseBlock,
	fraction: QuestionInterface.Manipulatives.Fraction,
	fractionContainer: QuestionInterface.Manipulatives.FractionContainer,
	manipulative: QuestionInterface.Manipulatives.Manipulative
};
